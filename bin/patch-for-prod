#!/bin/sh
set -e

PATCHES=$1

echo "\n\nApply patches for prod ..."

echo "\nPatch 1: api call change '-qa' addresses to '-prod' ..."
sed -i -e 's/simt-j-accounts-qa.fly.dev/simt-j-accounts-prod.fly.dev/' lib/backend/api_requests/api_calls.dart
sed -i -e 's/simt-j-billing-stripe-qa.fly.dev/simt-j-billing-stripe-prod.fly.dev/' lib/backend/api_requests/api_calls.dart

echo "\nPatch 2: change supabase address and key to supabase prod instance ...\n"
patch -p0 < $PATCHES/prod/supabase.dart.patch

echo "\nPatch 3: /sysinfo variables"
sed -i -e 's/replace_me_environment/prod/' lib/sys_info_page/sys_info_page_widget.dart
sed -i -e 's/replace_me_supabase_project/pqlwxerasppsyleweruk/' lib/sys_info_page/sys_info_page_widget.dart
